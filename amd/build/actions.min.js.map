{"version":3,"file":"actions.min.js","sources":["../src/actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript actions for the teacher checklist block.\n *\n * @module      block_teacher_checklist/actions\n * @copyright   2026 Jean LÃºcio <jeanlucio@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n\n    return {\n        init: function() {\n\n            /**\n             * Sends update requests to the server.\n             * @param {Array} itemsData Array of item objects.\n             */\n            function processUpdates(itemsData) {\n                var calls = itemsData.map(function(data) {\n                    return {\n                        methodname: 'block_teacher_checklist_toggle_item_status',\n                        args: data\n                    };\n                });\n\n                Ajax.call(calls)[calls.length - 1].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            }\n\n            // 1. INDIVIDUAL TOGGLE BUTTONS (Done, Ignore, Restore).\n            // We use delegated events on document or a main container for dynamic content support.\n            $('body').on('click', '[data-action=\"toggle-status\"]', function(e) {\n                e.preventDefault();\n                var btn = $(this);\n\n                processUpdates([{\n                    courseid: btn.data('courseid'),\n                    type: btn.data('type'),\n                    subtype: btn.data('subtype'),\n                    docid: btn.data('docid'),\n                    status: btn.data('status')\n                }]);\n            });\n\n            // 2. \"SELECT ALL\" LOGIC.\n            $('.select-all-toggle').on('change', function() {\n                var targetList = $(this).data('target');\n                var isChecked = $(this).is(':checked');\n\n                $(targetList).find('.item-checkbox').prop('checked', isChecked).trigger('change');\n            });\n\n            // 3. BULK ACTIONS VISIBILITY.\n            $('.item-checkbox').on('change', function() {\n                var container = $(this).closest('.tab-pane'); // Find parent tab pane.\n                var totalChecked = container.find('.item-checkbox:checked').length;\n                var bulkContainer = container.find('.bulk-actions-container');\n\n                if (totalChecked > 0) {\n                    bulkContainer.fadeIn(200);\n                } else {\n                    bulkContainer.fadeOut(200);\n                    // Uncheck main toggle if no items are checked.\n                    container.find('.select-all-toggle').prop('checked', false);\n                }\n            });\n\n            // 4. BULK ACTION BUTTONS.\n            $('.bulk-btn').on('click', function(e) {\n                e.preventDefault();\n                var btn = $(this);\n                var newStatus = btn.data('action');\n                var courseId = btn.data('courseid');\n                var container = btn.closest('.tab-pane');\n                var requests = [];\n\n                container.find('.item-checkbox:checked').each(function() {\n                    var chk = $(this);\n\n                    // Prevent marking \"auto\" items as \"done\" (status 1) via bulk action if needed,\n                    // but logic permits it if displayed. Assuming auto items CANNOT be manually marked done\n                    // unless they are removed from the list automatically.\n                    // Logic check: Auto items usually disappear when done in Moodle.\n                    // If the checkbox is there, we assume it's actionable.\n\n                    requests.push({\n                        courseid: courseId,\n                        type: chk.data('type'),\n                        subtype: chk.data('subtype'),\n                        docid: chk.data('docid'),\n                        status: newStatus\n                    });\n                });\n\n                if (requests.length > 0) {\n                    processUpdates(requests);\n                } else {\n                    Str.get_strings([\n                        {key: 'notice', component: 'moodle'},\n                        {key: 'no_items_selected', component: 'block_teacher_checklist'}\n                    ]).done(function(s) {\n                        Notification.alert(s[0], s[1], 'Ok');\n                    });\n                }\n            });\n\n            // 5. AUTO SCAN TOGGLE SWITCH.\n            $('.toggle-scan-switch').on('change', function() {\n                var isChecked = $(this).is(':checked');\n                var courseId = $(this).data('courseid');\n\n                processUpdates([{\n                    courseid: courseId,\n                    type:     'config',\n                    subtype:  'scan_enabled',\n                    docid:    0,\n                    status:   isChecked ? 1 : 0\n                }]);\n            });\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","init","processUpdates","itemsData","calls","map","data","methodname","args","call","length","done","window","location","reload","fail","exception","on","e","preventDefault","btn","this","courseid","type","subtype","docid","status","targetList","isChecked","is","find","prop","trigger","container","closest","totalChecked","bulkContainer","fadeIn","fadeOut","newStatus","courseId","requests","each","chk","push","get_strings","key","component","s","alert"],"mappings":";;;;;;;AAsBAA,yCAAO,CAAC,SAAU,YAAa,oBAAqB,aAAa,SAASC,EAAGC,KAAMC,aAAcC,WAEtF,CACHC,KAAM,oBAMOC,eAAeC,eAChBC,MAAQD,UAAUE,KAAI,SAASC,YACxB,CACHC,WAAY,6CACZC,KAAMF,SAIdR,KAAKW,KAAKL,OAAOA,MAAMM,OAAS,GAAGC,MAAK,WACpCC,OAAOC,SAASC,YACjBC,KAAKhB,aAAaiB,WAKzBnB,EAAE,QAAQoB,GAAG,QAAS,iCAAiC,SAASC,GAC5DA,EAAEC,qBACEC,IAAMvB,EAAEwB,MAEZnB,eAAe,CAAC,CACZoB,SAAUF,IAAId,KAAK,YACnBiB,KAAMH,IAAId,KAAK,QACfkB,QAASJ,IAAId,KAAK,WAClBmB,MAAOL,IAAId,KAAK,SAChBoB,OAAQN,IAAId,KAAK,gBAKzBT,EAAE,sBAAsBoB,GAAG,UAAU,eAC7BU,WAAa9B,EAAEwB,MAAMf,KAAK,UAC1BsB,UAAY/B,EAAEwB,MAAMQ,GAAG,YAE3BhC,EAAE8B,YAAYG,KAAK,kBAAkBC,KAAK,UAAWH,WAAWI,QAAQ,aAI5EnC,EAAE,kBAAkBoB,GAAG,UAAU,eACzBgB,UAAYpC,EAAEwB,MAAMa,QAAQ,aAC5BC,aAAeF,UAAUH,KAAK,0BAA0BpB,OACxD0B,cAAgBH,UAAUH,KAAK,2BAE/BK,aAAe,EACfC,cAAcC,OAAO,MAErBD,cAAcE,QAAQ,KAEtBL,UAAUH,KAAK,sBAAsBC,KAAK,WAAW,OAK7DlC,EAAE,aAAaoB,GAAG,SAAS,SAASC,GAChCA,EAAEC,qBACEC,IAAMvB,EAAEwB,MACRkB,UAAYnB,IAAId,KAAK,UACrBkC,SAAWpB,IAAId,KAAK,YACpB2B,UAAYb,IAAIc,QAAQ,aACxBO,SAAW,GAEfR,UAAUH,KAAK,0BAA0BY,MAAK,eACtCC,IAAM9C,EAAEwB,MAQZoB,SAASG,KAAK,CACVtB,SAAUkB,SACVjB,KAAMoB,IAAIrC,KAAK,QACfkB,QAASmB,IAAIrC,KAAK,WAClBmB,MAAOkB,IAAIrC,KAAK,SAChBoB,OAAQa,eAIZE,SAAS/B,OAAS,EAClBR,eAAeuC,UAEfzC,IAAI6C,YAAY,CACZ,CAACC,IAAK,SAAUC,UAAW,UAC3B,CAACD,IAAK,oBAAqBC,UAAW,6BACvCpC,MAAK,SAASqC,GACbjD,aAAakD,MAAMD,EAAE,GAAIA,EAAE,GAAI,YAM3CnD,EAAE,uBAAuBoB,GAAG,UAAU,eAC9BW,UAAY/B,EAAEwB,MAAMQ,GAAG,YAG3B3B,eAAe,CAAC,CACZoB,SAHWzB,EAAEwB,MAAMf,KAAK,YAIxBiB,KAAU,SACVC,QAAU,eACVC,MAAU,EACVC,OAAUE,UAAY,EAAI"}