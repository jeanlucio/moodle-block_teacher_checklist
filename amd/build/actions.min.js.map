{"version":3,"file":"actions.min.js","sources":["../src/actions.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    return {\n        init: function() {\n\n            /**\n             * Processa e envia as atualizações de status para o servidor.\n             *\n             * @param {Array} itemsData Lista de objetos contendo os dados dos itens a atualizar.\n             */\n            function processUpdates(itemsData) {\n                // Cria o array de chamadas para o Moodle\n                var calls = itemsData.map(function(data) {\n                    return {\n                        methodname: 'block_teacher_checklist_toggle_item_status',\n                        args: data\n                    };\n                });\n\n                // Executa em lote\n                Ajax.call(calls)[calls.length - 1].done(function() {\n                    window.location.reload();\n                }).fail(Notification.exception);\n            }\n\n            // 1. AÇÃO INDIVIDUAL (Botões laterais)\n            $('.block_teacher_checklist').on('click', '[data-action=\"toggle-status\"]', function(e) {\n                e.preventDefault();\n                var btn = $(this);\n                // Chama a função de processar (agora em camelCase)\n                processUpdates([{\n                    courseid: btn.data('courseid'),\n                    type: btn.data('type'),\n                    subtype: btn.data('subtype'),\n                    docid: btn.data('docid'),\n                    status: btn.data('status')\n                }]);\n            });\n\n            // 2. LÓGICA DO \"SELECIONAR TODOS\"\n            $('.select-all-toggle').on('change', function() {\n                var targetList = $(this).data('target');\n                var isChecked = $(this).is(':checked');\n\n                // Marca/Desmarca todos os checkboxes VISÍVEIS dentro da lista alvo\n                $(targetList).find('.item-checkbox').prop('checked', isChecked).trigger('change');\n            });\n\n            // 3. EXIBIR/OCULTAR BARRA DE AÇÕES EM MASSA\n            $('.item-checkbox').on('change', function() {\n                // Procura a barra de ações mais próxima (dentro da mesma aba)\n                var container = $(this).closest('.tab-pane');\n                var totalChecked = container.find('.item-checkbox:checked').length;\n\n                if (totalChecked > 0) {\n                    container.find('.bulk-actions-container').fadeIn(200);\n                } else {\n                    container.find('.bulk-actions-container').fadeOut(200);\n                    // Desmarca o \"Select All\" se desmarcar um item\n                    container.find('.select-all-toggle').prop('checked', false);\n                }\n            });\n\n            // 4. CLIQUE NOS BOTÕES DE AÇÃO EM MASSA\n            $('.bulk-btn').on('click', function(e) {\n                e.preventDefault();\n                var btn = $(this);\n                var newStatus = btn.data('action');\n                var courseId = btn.data('courseid');\n                var container = btn.closest('.tab-pane');\n\n                var requests = [];\n\n                // Varre todos os checkboxes marcados nesta aba\n                container.find('.item-checkbox:checked').each(function() {\n                    var chk = $(this);\n\n                    // IMPORTANTE: Se a ação for \"Feito\" (status 1) e o item for automático, IGNORA.\n                    if (newStatus == 1 && chk.data('type') === 'auto') {\n                        return; // Pula este item\n                    }\n\n                    requests.push({\n                        courseid: courseId,\n                        type: chk.data('type'),\n                        subtype: chk.data('subtype'),\n                        docid: chk.data('docid'),\n                        status: newStatus\n                    });\n                });\n\n                if (requests.length > 0) {\n                    processUpdates(requests);\n                } else {\n                    // Feedback caso tente marcar automático como feito\n                    Notification.alert('Aviso', 'Nenhum item válido selecionado para esta ação.', 'Ok');\n                }\n            });\n\n            // 5. NOVO: INTERRUPTOR DE VARREDURA AUTOMÁTICA\n            $('#toggleScan').on('change', function() {\n                var isChecked = $(this).is(':checked');\n                var courseId = $(this).data('courseid');\n\n                // Envia como um item especial do tipo 'config'\n                processUpdates([{\n                    courseid: courseId,\n                    type:     'config',\n                    subtype:  'scan_enabled',\n                    docid:    0,\n                    status:   isChecked ? 1 : 0\n                }]);\n            });\n\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","init","processUpdates","itemsData","calls","map","data","methodname","args","call","length","done","window","location","reload","fail","exception","on","e","preventDefault","btn","this","courseid","type","subtype","docid","status","targetList","isChecked","is","find","prop","trigger","container","closest","fadeIn","fadeOut","newStatus","courseId","requests","each","chk","push","alert"],"mappings":"AAAAA,yCAAO,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,oBAE5D,CACHC,KAAM,oBAOOC,eAAeC,eAEhBC,MAAQD,UAAUE,KAAI,SAASC,YACxB,CACHC,WAAY,6CACZC,KAAMF,SAKdP,KAAKU,KAAKL,OAAOA,MAAMM,OAAS,GAAGC,MAAK,WACpCC,OAAOC,SAASC,YACjBC,KAAKf,aAAagB,WAIzBlB,EAAE,4BAA4BmB,GAAG,QAAS,iCAAiC,SAASC,GAChFA,EAAEC,qBACEC,IAAMtB,EAAEuB,MAEZnB,eAAe,CAAC,CACZoB,SAAUF,IAAId,KAAK,YACnBiB,KAAMH,IAAId,KAAK,QACfkB,QAASJ,IAAId,KAAK,WAClBmB,MAAOL,IAAId,KAAK,SAChBoB,OAAQN,IAAId,KAAK,gBAKzBR,EAAE,sBAAsBmB,GAAG,UAAU,eAC7BU,WAAa7B,EAAEuB,MAAMf,KAAK,UAC1BsB,UAAY9B,EAAEuB,MAAMQ,GAAG,YAG3B/B,EAAE6B,YAAYG,KAAK,kBAAkBC,KAAK,UAAWH,WAAWI,QAAQ,aAI5ElC,EAAE,kBAAkBmB,GAAG,UAAU,eAEzBgB,UAAYnC,EAAEuB,MAAMa,QAAQ,aACbD,UAAUH,KAAK,0BAA0BpB,OAEzC,EACfuB,UAAUH,KAAK,2BAA2BK,OAAO,MAEjDF,UAAUH,KAAK,2BAA2BM,QAAQ,KAElDH,UAAUH,KAAK,sBAAsBC,KAAK,WAAW,OAK7DjC,EAAE,aAAamB,GAAG,SAAS,SAASC,GAChCA,EAAEC,qBACEC,IAAMtB,EAAEuB,MACRgB,UAAYjB,IAAId,KAAK,UACrBgC,SAAWlB,IAAId,KAAK,YACpB2B,UAAYb,IAAIc,QAAQ,aAExBK,SAAW,GAGfN,UAAUH,KAAK,0BAA0BU,MAAK,eACtCC,IAAM3C,EAAEuB,MAGK,GAAbgB,WAAuC,SAArBI,IAAInC,KAAK,SAI/BiC,SAASG,KAAK,CACVpB,SAAUgB,SACVf,KAAMkB,IAAInC,KAAK,QACfkB,QAASiB,IAAInC,KAAK,WAClBmB,MAAOgB,IAAInC,KAAK,SAChBoB,OAAQW,eAIZE,SAAS7B,OAAS,EAClBR,eAAeqC,UAGfvC,aAAa2C,MAAM,QAAS,iDAAkD,SAKtF7C,EAAE,eAAemB,GAAG,UAAU,eACtBW,UAAY9B,EAAEuB,MAAMQ,GAAG,YAI3B3B,eAAe,CAAC,CACZoB,SAJWxB,EAAEuB,MAAMf,KAAK,YAKxBiB,KAAU,SACVC,QAAU,eACVC,MAAU,EACVC,OAAUE,UAAY,EAAI"}